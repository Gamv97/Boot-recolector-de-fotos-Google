package recolector;
import java.awt.AWTException;
import java.awt.Desktop;
import java.awt.Rectangle;
import java.awt.Robot;
import java.awt.event.InputEvent;
import java.awt.event.KeyEvent;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URISyntaxException;
import java.net.URL;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.imageio.ImageIO;



public class Bot extends Thread {
  String tema = "";
  String ubicacionFotos = "";
  int cantidadFotos;
  Robot miRobot;
  DateFormat dateFormat = new SimpleDateFormat("HHmmss");
  Date date = new Date();

  public Bot(String tema, int cantidadFotos, String ubicacionFotos) {
    this.tema = tema;
    this.tema = tema.replace(' ', '-');
    this.cantidadFotos = cantidadFotos;
    this.ubicacionFotos = ubicacionFotos;
  }

  public void run() {
    try {
      miRobot = new Robot();
    } 
    catch (AWTException e) {
      e.printStackTrace();
    }
    miRobot.setAutoWaitForIdle(true);
    miRobot.setAutoDelay(100);

    try {
      proceso();
    } 
    catch (IOException e) {
      e.printStackTrace();
    }
  }

  void proceso() throws IOException {
    abrirGoogleImagen();
    procesoFotos();
    System.exit(0);
  }

  private void abrirGoogleImagen() {
    URL Url =null;
    try {


      Url = new URL("https://www.google.com.mx/search?q="+tema+"&source=lnms&tbm=isch&sa=X&ved=0ahUKEwi_9L-rsbPiAhUGSa0KHTHXC6IQ_AUIDygC&biw=1366&bih=654");
      try {
        Desktop.getDesktop().browse(Url.toURI());
      } 
      catch (IOException e) {
        e.printStackTrace();
      } 
      catch (URISyntaxException e) {
        e.printStackTrace();
      }
    } 
    catch (MalformedURLException e1) {
      e1.printStackTrace();
    }
  }

  private void procesoFotos() {
    try {
      Thread.sleep(4000);
      miRobot.mouseMove(150, 600);
      miRobot.mousePress(InputEvent.BUTTON1_DOWN_MASK);
      miRobot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);
      Thread.sleep(5000);
      for (int i = 0; i< cantidadFotos; i++) {
        Thread.sleep(1000);
        tomarUnaFoto(i);
        miRobot.keyPress(KeyEvent.VK_RIGHT);
        miRobot.keyRelease(KeyEvent.VK_RIGHT);
      }
    }
    catch (InterruptedException e1) {
      // TODO Auto-generated catch block
      e1.printStackTrace();
    }
  }

  private void tomarUnaFoto(int indice) {

    BufferedImage miImagen = miRobot.createScreenCapture(new Rectangle(260, 260, 360, 360));
    File outputfile = new File(ubicacionFotos+"/"+dateFormat.format(date)+indice+".jpg");
    try {
      ImageIO.write(miImagen, "jpg", outputfile);
    } 
    catch (IOException e) {
      System.out.print("esto ya chafio");
      e.printStackTrace();
    }
  }
}

/*
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#@@@@@@@@@@@@@@@@@###@@@@@@@@@@@@#@@@@@@@@@@@@@@@@@###@@@@@@@#####@@###@#@@@@@##+##+#@
@############################@####@@@@@@###@####@########@@@@##+#@########@@@@##++#'#@
@##########################@@@@####+##@@@@#@@###@@######@@@@@@###########@@@@@@@###+#@
###############@#############@##+++##''#@@@@@@###@######@@@@@@@##########@@@@@@@###+#@
###########################@@#++++++##+'#@@@@@@@@#######@@@@@@@#@@#######@@@@@@@###+#@
#######@#####@#############@@#++'+++####+###@@@@@#######@@@@@@@@@@@@@####@@@@@@@#@#++@
###########################@@+'''+++#####'###@@@@@@@@@@@@@@@@@@@@@@#@#@@@@@@@@@@@@#++@
@####################@#@@@@@#+++'''++####''########@@@@@@@@@@########@@@@@@@@@@@@@#++@
####################@@@@@@@@#+++''''+####+;+########@@@@@@@###########@@@@@@@@@@@@@++@
#######@##########@@@@@@@@@@#++''+''''++++;;+########@@@@@#############@@#@@@@@@@##++@
#################@@@@@@@@@@@#'''''++++''+';:;+#@######@@@#########+'+###@@@@##@@###++@
@#@########@#####@@@@@@@@@@@#''+++++++''''';;'+#######@@#########':;;'++##@@@###+##++@
########@@##@##@#@@@@@@@@@@@#'+++++#+'';''';:;'+####@@@@@######+;;;'''++###@###++##++@
####@##@########@@@@@@@@@@@@+''+##+'''''';;;:;;''++#@@@@@@####+;:;'''++#########+##++@
#@#####@######@#@@@@@@@@@@@@+'+++'++''''';;;:;;;;;''+#++##+++';::'''+++##@@@@###+##++@
##@##@#@######@##@@@@@@@@@@@#'++++++';;';;;::::::;;;;;'''''+;:::;''++++#@@@@@###+###+@
#####@######@@@@@@@@@@@@@@@@@+'++'''';;;;;;:::::::;;::;;;;;;;:::;'''++#@@@@@@@######+@
#@########@#@@@@@@@@@@@@@@@@@@''++++';;;;::::::::::::;::;;::::::;''''+##@@@@@@@@####+@
#########@@@@@@@@@@@@@@@@@@###+''++'';;;::::::::::::::::::::::::;;''++#@@@@@@@@@@@##+@
@###########@#@@@@@@@@@@@@@##+++'++'';;;::::::::::::::::::::::::;'''''##@@@@@@@@@@@#+@
############@####@@@@@@@#++++''''''';;;::::::::,:::::::::::::::::;''''##@@@@@@@@@@@@+@
###@#@######@##@@@@@@@@@#+''';;''''';;;;:::::::::::,:::::::::::::;'''+##@@@@@@@@@@@@+#
#######@####@##@@@@@@@@@++'''';;';;';;;;::::::::::::,::::::::::::;'''+@@@@#@@@@@@@@@+#
#######@#####@@@@@@@@@@@#+''''''';;;;;;;::::::::::::::::,::::::::;'''##@@@##@@@@@@##+#
@#@##########@@@@@@@@@@#+''''''''';;;;:::::::::::,::::::::::::::;;''+##@@@@@@@@@####+#
@@@@#####@@@@@@@@@@@###++'''''''';;;;;:;;::::::::,::::::,::::::::;;+#####@@@@##++###+#
@@@@#@@@@@@@@@@@@@@@#+++'''''''';;;;;;:::::::::::::::::::,:::::;;;;+#######@########+#
#@#@#@#@@@@@@@@@@@####''''''';;;;;;;;:::;;+#;:::,:::,,::::::::::;;'+#########+######+#
@##@@@@@@@@@@@@#@@@#+'';';;;;;;;;;;;;:::'@#@#::::,:,,,::::,:::::;;'+######@@########+#
###@@@@@@@@@@@@@@@#+'';;;;;;;;:;;::;;::;@@#@#::,,,,,,,,,::::;::::;;+####@@@@@@###+####
@#@@#@@@@@@@@@@@@##+;;;;::;::::::::;;::+@@;;#::,,,,,,,,,,,,:::;;:;;'+##@##@@#@@#+#####
#@@@@@#@@@@@##@#@#+';;;::;:::::::::::::'@@#+;::,,,,,,,,,,,,''::;:;;;'####++##@@@######
##@@@@@@@@@@####+';;;;:::::::::::::::::;'++;::,,,,,,,,,,,,;#@;:::;;;+##########@#@@###
#@@@@@@@@@@@@##''';;;;:::::::::::::::::::::::,,,,,,.,,,,,,,;@+:::;;;+++#++#@@###;@@@#+
#@@@@@#@@@@@@#+'';;;:::;;::::::::::::::,::,,,,,,,,.,,,,,,,;+#';::;;;'+######@###;+:;;+
@@#@@@@@@@@##+'';;;;::;;::;::;;::::::::,:,,,,,,,,,..,,,,,,;##;;;;;;;;+++#####'';;;::::
@####@@#@###'''';;::::;;::;:;;:;::::::::,,,:,,,,,,...,,,,,:'':;;;;;;'+####+++:::::::;;
#######@##@#+'';;;;;;;;;::;:;:::::::::,:,,,::::,,,,,,,,,,,::::;;;;;;'+##@++++:::::;::,
#######@@##+''';;;;;;;;;:::;;::::::::,:,,::::::,,,,..,,,,::::::;;;;;;+;+;+;;:,::;;;::,
#######@#@+''';;;;;;;'';::;;:,::::::,,,,,::::::,,....,,,,::::::;;;;;;;::::;:::;;;;::,,
##@@######++';;;;;;;;'';::;;::::::::,,,,:::::::,,,,.,,,,,::::::::;;;;;:::,;::;;;;:::::
#@@@###@#+'';;;;;;;;::::::::::::::,,,,,:::::::::,,,,,,,,,::::::::::;;:::::;;:;::::::::
#@@@##@##+';;;;;;;;:,::,:::,,:::::::,,,::::::::::::,,,,::::::::::::;;;:::::::;;;::::::
#@@@@@##+'';;;;;;;;:::;:,::,,:::::,,,,,:::::::::::::,,:::::::::::::;;:::,:,,::::::,:,:
#@@@@@##+'';;;;;;;;:::::::,..::::,,,,,,,:::::::::::::::::::::::::::;;::,:::,::::::,,::
#@@@@@##+';;;;;;;:;;:,,,,,,.,,,:::,,,,,:::::::::::::::::::::::::::::;:::::::::::::::,,
#@@@@@#+''';;;;;;:;;;:,:,,,,,,::::::,,,,:::::::::::::::,,,::::::::::;::::;::::::::::::
#@@@@@@#''';;;;;;;;;;;:::::::::;;:::,,,,,::::::;:::::::::,,:::::::::;;:::;:,;:::::,;;;
#@@@@@@#+'';;;;;;;:;;:::,,,::::;;;::,,,,,,::::::::::::,,,,,,:,,:::::;';;:,,::::,,,,:,:
@@@@@@@#+''';;;;;:::::,,,,,:::;;;;;:::,,,,,,::::;;::::,,,,:,:::,,,::;;::::,::::::::::,
#@@@@@@#+''';;;;;:::::,,,,,:::;;;;;;:::,,,,,::::;;;:::,,,,:::,:::,,::::,:;:::,,:::::,,
@@@@@@@@#+'';;;;;:::::,,,,:::::;;;;;;:;;:,,,,,,:';:::,,,,,,:,,,::::::::,;;:::,::::::,,
@@@@@@@@#+'';;;;;::::,,,,,,:::::;;;;;:::::;::::::,,,,,,,,,,,:,:,,:::::,:;;:;:::::,::,,
@@@@@@@@#+'';;;;;:::,,,,,,,,:::;:;;:;:::,,,:::::;:,,,,,,,:::::,:::::::,:::::;,,:;,,,,,
@@@@@@@@@++';;;;:::::,,,,,,,:::::;;:::::,,,,:::::::::,,,:::::::::,:::,:::::;:,,::,,,,,
#@@@@@@@@#+'';;;:::::,,,,,,:::::::::::::,,,:,,,,,,,,::::::::::::::::::::::,,::::::,,,,
@@@@@@@@@#++';;;::::::,,,,::::::::::::,,,,,,:::,:,,::::::::::,::::::;:,:;::,,,,;,,,,,,
@@@@@@@@@@#'';;;;::::,,,:::::::::::::,,,...,,::::::::::::::::,:::::::::;;;:,,,:,,:,,,,
@@@@@@@@@@#+';;;;::::,,::::::::::::::,,...,,,:::::::::::::::::::::::::;;::::,,:,,,:,:,
@@@@@#@@@@#++'';;:::::::::::::::::::,,....,,,:::::::::::,:::::::::::::::::;:::::,,::,,
@@@@@@@@@#+++'';;;::::::::::::::::::,,..,,,:::::::::,:,:,,,,::::::::::::;;:::::,:,,:,,
#@@@@@@@@++++'';;;::::::::::::::::::,,,,,:::::::::,,,,,,,,,,,,:::::::::;:::::,,:,,,,,,
#@@@@@@@@++'++'';;;;:::::::::::::::,,,::::::::::::,,::,,,,,,,:::::::::;;:::::,::,,,,,.
@@@@@@@@#++''''';;;;::::::::::::::,,,,:::::::::::::,::::,,,,:::::::;;;;;::::;:::::,,,.
@@@@@@@@@++''''';;;;::::::::::::,,,,:::::::::::::,,::::,,,,,:::::::;;;:::::;;;::::,:,,
#@@@@@@@@++''';;;;;;;:::::::::::,,,,:::::::::::::::::::,,,,,,::::;:;;;::::;::,:::,,,::
#@@@@@@@##+''';;;;;;;;::::::::::,,,:::::::::::::::::::,,,,,,,::::::;;;:,,::::,,;:::::,
@@@@@@@@@@#'''';;;;;;;:::::::::,,,,::::::::::::::::::::,,,,,::::::;;;;::,,:;::::::::,:
@@@@@@@@@@#++'';;;;;;;;;::::::::::::::::::::::::,:,::,,,,,,,::::::;;;;;:::::::;,:::,::
@@@@@@@@@@##+'';;;;;;;;::::::::::::::::::::::::,,,,:,,,,,,,:::::::;;;;;;::,,,::,::::;:
#@@@@@@@@@@@+'';;;;;;;;:::::::::::;::::::::::,,,,,,,,,,,,,,:::::::;;;;;;::,,,:,,::,,,:
#@@@@@@@@@@#+'''';;;;;:;:::::::::::;::::::::,,,,,,,,,,,,,::::::::::;;;;;::,,,:,,,:,.,,
#@@@@@@@@@@@#++''';;;;;;::::::::;;;;::::::::,,,,,,,,,,,,,::::::::::;;;;;::,,:,,,,::,,,
#@@@@@@@@@@@#++'';;;;;;;;;;::::::;;;::::,,,,,,,,,,,,,,,:::::::::::::;;;;:::,::,,,:,,,,
#@@@@@@@@@@@@+++'';;;;;;;;;::::;;;;;::::,,,,,,,,,,,,,,,:::;:::::::;;;::::::::,,,:;:,.,
#@@@@@@@@@@@@+'''''';;;;;;::;::;;;;;:::,,,...,,,,,,,,,,:::::::::::::::::::::::::::::::
#@@@@@@@@@@@@+'''''';;;;;;::;;:;;;;;;:,,.......,,,,,,,,:::::::::::::::::::::;:::::,:::
#@@@@@@@@@@@@+';'''';;;;;;;;;;:;;;::,,.........,,,,,,,::::::::::::::::::::::,.,::;,;,:
#@@@@@@@@@@@@++''';'';;;;;;;;;;;':,,,,,........,,,,:,:::::::::,:::::::::::::::;:::,,,:
#@@@@@@@@@@@@#+'';;';';;;;;;;;;'.,,,,,,,.......,,,,:::::::::::::::::::::::::::,:,,.:,,
@@@@@@@@@@@@@@#+'';';;;;;;::;;;,,.,,,.,,.....,,,,,::::::::::::::::::::::::::::,;:,,:,,
@@@@@@@@@@@@@@#+'';';;;;;;:;;;,,,,,,...,,...,,,,::::::::::::::::::::,:::::::::::;:,,,,
@@@@@@@@@@@@@@@#+';''';;;;;'''::,,,.,,.,,..:,,,:::::::::::::::::,,,:,,:::::::::;:,,:::
@@@@@@@@@@@@@@@##+'''';;;;;''+';:,.,,,,,,.,;:;::::::::::::::::::,,,,,,,:::,:::::,,.,,.
@@@@@@@@@@@@@@@@@+'''';;;;;;''';:::,,.,,,,:;:::::::::::::::::,,,,,,,,,,,:,::::,::;:;,.

*/